<!DOCTYPE html>
<html>
<head>
  <title>IFrame API Test</title>
  <style>
    body {
      font-family: system-ui, -apple-system, sans-serif;
      margin: 20px;
      background: #f0f0f0;
    }
    .control-panel {
      background: white;
      padding: 20px;
      border-radius: 8px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }
    .status {
      margin-top: 20px;
      padding: 10px;
      background: #e0e0e0;
      border-radius: 4px;
    }
    button {
      margin: 5px;
      padding: 8px 16px;
      border: none;
      border-radius: 4px;
      background: #007bff;
      color: white;
      cursor: pointer;
    }
    button:hover {
      background: #0056b3;
    }
    .grid {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 10px;
      margin-bottom: 20px;
    }
    input {
      padding: 8px;
      border: 1px solid #ddd;
      border-radius: 4px;
    }
  </style>
</head>
<body>
  <div class="control-panel">
    <h2>IFrame API Test Panel</h2>
    
    <div class="grid">
      <div>
        <h3>Position</h3>
        <div>
          <label>X: <input type="number" id="posX" value="0.1" step="0.1" min="0" max="1"></label>
        </div>
        <div>
          <label>Y: <input type="number" id="posY" value="0.1" step="0.1" min="0" max="1"></label>
        </div>
        <button onclick="updatePosition()">Update Position</button>
      </div>
      
      <div>
        <h3>Size</h3>
        <div>
          <label>Width: <input type="number" id="width" value="0.3" step="0.1" min="0.1" max="1"></label>
        </div>
        <div>
          <label>Height: <input type="number" id="height" value="0.3" step="0.1" min="0.1" max="1"></label>
        </div>
        <button onclick="updateSize()">Update Size</button>
      </div>
    </div>

    <div>
      <h3>Message to Parent</h3>
      <input type="text" id="message" placeholder="Enter message" style="width: 200px;">
      <button onclick="sendMessage()">Send Message</button>
    </div>

    <div>
      <button onclick="getInfo()">Get Widget Info</button>
    </div>

    <div class="status" id="status">
      Status: Checking API connection...
    </div>
  </div>

  <script>
    // Check for API availability
    window.onload = function() {
      const status = document.getElementById('status');
      if (window.parentAPI) {
        status.textContent = 'Status: API Connected ✅';
        // Get initial widget info
        getInfo();
      } else {
        status.textContent = 'Status: No API Connection ❌';
      }
    }

    function updateStatus(message) {
      const status = document.getElementById('status');
      status.textContent = 'Status: ' + message;
    }

    function updatePosition() {
      if (!window.parentAPI) return updateStatus('No API Connection');
      
      const x = parseFloat(document.getElementById('posX').value);
      const y = parseFloat(document.getElementById('posY').value);
      
      try {
        window.parentAPI.updatePosition(x, y);
        updateStatus(`Position updated to x:${x}, y:${y}`);
      } catch (e) {
        updateStatus('Error updating position: ' + e.message);
      }
    }

    function updateSize() {
      if (!window.parentAPI) return updateStatus('No API Connection');
      
      const width = parseFloat(document.getElementById('width').value);
      const height = parseFloat(document.getElementById('height').value);
      
      try {
        window.parentAPI.updateSize(width, height);
        updateStatus(`Size updated to width:${width}, height:${height}`);
      } catch (e) {
        updateStatus('Error updating size: ' + e.message);
      }
    }

    function sendMessage() {
      if (!window.parentAPI) return updateStatus('No API Connection');
      
      const message = document.getElementById('message').value;
      try {
        window.parentAPI.sendToParent({
          type: 'custom',
          message: message
        });
        updateStatus('Message sent: ' + message);
      } catch (e) {
        updateStatus('Error sending message: ' + e.message);
      }
    }

    function getInfo() {
      if (!window.parentAPI) return updateStatus('No API Connection');
      
      try {
        const info = window.parentAPI.getWidgetInfo();
        updateStatus('Widget Info: ' + JSON.stringify(info, null, 2));
      } catch (e) {
        updateStatus('Error getting info: ' + e.message);
      }
    }

    // Listen for messages from parent (for cross-origin communication)
    window.addEventListener('message', function(event) {
      // Verify origin in production
      // if (event.origin !== "expected-origin") return;
      
      updateStatus('Received message from parent: ' + JSON.stringify(event.data));
    });
  </script>
</body>
</html>